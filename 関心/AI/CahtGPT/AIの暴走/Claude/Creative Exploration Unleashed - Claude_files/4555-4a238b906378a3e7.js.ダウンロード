"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4555],{34555:function(e,t,n){n.d(t,{CodeRenderer:function(){return T},B:function(){return k},MarkdownRenderer:function(){return N}});var s=n(27573),o=n(61995),r=n(2210),a=n(405),i=n(20147),l=n(39527),c=n(82083),d=n(96707),u=n(10607),p=n(7653),m=n(41668),h=n(84575),g=n(70354),f=n(1133),x=n(52681),b=n(40313),y=n(8927),v=n(68425),C=n(40950),w=n(45790);let S=e=>{let{isStreaming:t,children:n,...o}=e;return t?n:(0,s.jsx)(z,{...o,children:n})},z=e=>{let{children:t,sendMessage:n,contentType:o="text",isOpen:r}=e,a=(0,C.Z)(),i=void 0!==n,[l,c]=(0,p.useState)([]),[d,m]=(0,p.useState)({top:0,left:0,width:0}),[S,z]=(0,p.useState)(!1),[R,j]=(0,p.useState)(!1),[E,M]=(0,p.useState)(""),[q,k]=(0,p.useState)(""),[T,N]=(0,p.useState)(!1),P=(0,p.useRef)(null),O=(0,p.useRef)(null),A=(0,p.useCallback)((e,t)=>{var n;let s=function(e,t){let n=[];for(let s=0;s<e.rangeCount;s++){let o=e.getRangeAt(s);if(o.startContainer===o.endContainer&&o.startContainer.nodeType===Node.TEXT_NODE){let e=o.startContainer,t=document.createRange();for(let s=o.startOffset;s<o.endOffset;s++){t.setStart(e,s),t.setEnd(e,s+1);let o=Array.from(t.getClientRects());n.push(...o)}t.detach()}else{let e=function(e){let t;let n=[],s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=s.nextNode();)n.push(t);return n}(o);e.forEach((s,r)=>{let a=document.createRange(),i="length"in s?s.length:0,l=0===r,c=r===e.length-1,d=l?o.startOffset:0,u=c&&!t?o.endOffset:i;a.setStart(s,d),a.setEnd(s,u);let p=Array.from(a.getClientRects());n.push(...p),a.detach()})}}return n}(e,t),o=null===(n=P.current)||void 0===n?void 0:n.getBoundingClientRect();return Array.from(s).map(e=>({top:e.top-((null==o?void 0:o.top)||0)-2.5,left:e.left-((null==o?void 0:o.left)||0),width:e.width,height:e.height+5.5}))},[]),I=(0,p.useCallback)(e=>{var t;let n=e.getRangeAt(0);return null===(t=P.current)||void 0===t?void 0:t.contains(n.commonAncestorContainer)},[]);(0,p.useEffect)(()=>{function e(e){var t,n,s,o;let r,a,{selection:i,isSelectAll:l}=e,d=A(i,l);if(d.every((e,t,n)=>0===t||5>Math.abs(e.top-n[0].top))){let e=Math.max(...d.map(e=>e.left+e.width));r=d[0].top-9,a=e+10}else{let e=Math.max(...d.map(e=>e.top+e.height));a=Math.min(...d.map(e=>e.left)),r=Math.min((null!==(s=null===(n=P.current)||void 0===n?void 0:n.scrollHeight)&&void 0!==s?s:0)-50,e)}let u=((null!==(o=null===(t=P.current)||void 0===t?void 0:t.scrollWidth)&&void 0!==o?o:1e3)-a)/3*2;c(d),z(!0),j(!1),m({top:r,left:a,width:u}),k(i.toString())}let t=()=>{N(!0)},n=t=>{"Escape"===t.key&&(j(!1),z(!1),M(""),c([]));let n=((0,f.V5)()?t.metaKey:t.ctrlKey)&&"a"===t.key,s=P.current;if(s&&r&&n){let n=document.activeElement&&(document.activeElement===s||(null==s?void 0:s.contains(document.activeElement))),o=window.getSelection();if(n&&o){t.preventDefault();let n=document.createRange();n.selectNodeContents(s),o.removeAllRanges(),o.addRange(n),e({selection:o,isSelectAll:!0})}}},s=t=>{if(O.current&&O.current.contains(t.target))return;let n=window.getSelection();n&&!n.isCollapsed&&I(n)?e({selection:n}):(c([]),z(!1),j(!1),k(""),M("")),N(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",s),document.addEventListener("keydown",n)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",s),document.removeEventListener("keydown",n)}},[A,I,i,r]);let L=e=>{i&&(n(e),M(""),j(!1),z(!1),c([]))},F=()=>"text"===o?q.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===o?"```\n".concat(q,"\n```"):void 0,H=()=>{L({prompt:"".concat(F(),"\n\n").concat(E),attachments:[],files:[],syncSources:[]})};return(0,s.jsxs)("div",{className:"w-full h-full relative",children:[(0,s.jsx)("div",{ref:P,tabIndex:0,className:(0,u.W)("w-full h-full relative",i?T?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),l.map((e,t)=>(0,s.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,s.jsx)(y.M,{children:S&&!R&&(0,s.jsx)(v.E.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:d.top+5,left:d.left},children:(0,s.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,s.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,s.jsxs)(h.w,{onClick:()=>{j(!0)},isAssistant:!0,children:[(0,s.jsx)(x.A,{size:16}),(0,s.jsx)(w.Z,{defaultMessage:"Improve",id:"BATKcMm/a2"})]}),(0,s.jsxs)(h.w,{onClick:()=>{L({prompt:"".concat(a.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(F()),attachments:[],files:[],syncSources:[]})},isAssistant:!0,children:[(0,s.jsx)(b.v,{size:16}),(0,s.jsx)(w.Z,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})]})]})})})}),(0,s.jsx)(y.M,{children:R&&(0,s.jsxs)(v.E.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:d.top+5,left:d.left,width:d.width},ref:O,onSubmit:e=>{e.preventDefault(),H()},children:[(0,s.jsx)("input",{type:"text",value:E,onChange:e=>M(e.target.value),placeholder:a.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,s.jsx)(y.M,{children:E.trim().length>0?(0,s.jsx)(v.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,s.jsx)(g.z,{onClick:()=>H(),"aria-label":a.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,s.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,s.jsx)(w.Z,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var R=n(80151);let j=e=>{let{handleClose:t,title:n,description:o,inset:r,action:a}=e;return(0,s.jsxs)("div",{className:"border-border-300 shadow-sm w-[300px] max-w-full bg-bg-000 rounded-xl p-5 border relative",children:[(0,s.jsx)("div",{className:"text-left mb-2 font-medium text-sm",children:n}),(0,s.jsx)("p",{className:"mb-2 text-sm",children:o}),!!r&&(0,s.jsx)("div",{className:"flex flex-col rounded-md bg-text-000 bg-opacity-5 p-4 font-mono text-xs text-text-300",children:r}),a&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(g.z,{variant:"primary",className:"mt-4 text-sm",onClick:a.onClick,disabled:a.disabled,loading:a.loading,children:a.label})}),(0,s.jsx)("div",{className:"absolute top-2 right-2",children:(0,s.jsx)(g.z,{variant:"ghost",onClick:t,className:"h-9 w-9 !min-w-9",children:(0,s.jsx)(R.X,{})})})]})},E=e=>{var t,n,o;let{error:r,handleClose:a,sendMessage:i,isStreaming:l}=e,[c,d]=(0,p.useState)(!1),u=(0,C.Z)(),m=function(e,t){switch(e.type){case"UnsupportedImports":return{title:t?t.formatMessage({defaultMessage:"Artifact failed to load",id:"NcDXiSfIPe"}):"Artifact failed to load",description:t?t.formatMessage({defaultMessage:"The generated artifact uses libraries we don’t support:",id:"HG0Hu8xIQA"}):"The generated artifact uses libraries we don’t support:",inset:[...e.unsupportedModules,...e.nonExistentIcons.map(e=>"{ ".concat(e,' } from "lucide-react"'))],subtext:t?t.formatMessage({defaultMessage:"The code itself may still work. To use it, you’ll need a development setup with these libraries installed.",id:"Et/uvuRBba"}):"The code itself may still work. To use it, you’ll need a development setup with these libraries installed."};case"RuntimeError":return{title:t?t.formatMessage({defaultMessage:"Error running artifact",id:"JU2kK1J3jY"}):"Error running artifact",description:t?t.formatMessage({defaultMessage:"An error occurred while trying to run the generated artifact.",id:"3RpkNRAyPc"}):"An error occurred while trying to run the generated artifact.",inset:[e.message],insetStyle:"danger"};case"FileNotFound":return{title:t?t.formatMessage({defaultMessage:"File not found",id:"gcaJtRf4b0"}):"File not found",description:t?t.formatMessage({defaultMessage:"The file “{fileName}” could not be found.",id:"0kOCGtB3eN"},{fileName:e.fileName}):"The file “".concat(e.fileName,"” could not be found."),subtext:t?t.formatMessage({defaultMessage:"Please check the file name and try again.",id:"/fdYJU5SMC"}):"Please check the file name and try again."};case"ClaudeCompletionError":return{title:t?t.formatMessage({defaultMessage:"Error in Claude completion",id:"ya5HK9oB9T"}):"Error in Claude completion",description:e.message}}}(r.error,u),h="> ".concat(m.description,"\n  ").concat(null!==(o=null===(t=m.inset)||void 0===t?void 0:t.map(e=>"> `".concat(e,"`")).join("\n"))&&void 0!==o?o:"","\n  \n\n  Can you fix this error in `").concat(r.artifactId,"`?"),g=i?{label:u.formatMessage({defaultMessage:"Try fixing with Claude",id:"wrcoZ2Zo0b"}),onClick:()=>{d(!0),null==i||i({prompt:h,attachments:[],files:[],syncSources:[]})},disabled:l,loading:c}:void 0;return(0,s.jsx)("div",{className:"absolute bottom-5 left-5 right-5",children:(0,s.jsx)(j,{title:m.title,description:m.description,handleClose:a,inset:(null===(n=m.inset)||void 0===n?void 0:n.length)?m.inset?(0,s.jsx)("ul",{children:m.inset.map((e,t)=>(0,s.jsx)("li",{children:e},t))}):null:void 0,action:g})})};var M=n(56065);let q="opacity-30 blur-[2px]",k=e=>{let{isOpen:t,content:n,language:o,citations:r,type:a,showRaw:i,richSandboxRef:d,isCurrentStreaming:m,isChatStreaming:h,onSandboxConfirmation:g,sendMessage:f,richSandboxCapabilities:x,isLatestVersion:b,artifactId:y,artifactVersion:v,onArtifactRuntimeError:C,artifact:w,hasMenuOpen:S,zoom:z}=e,R=void 0!==a&&void 0!==n&&a!==c.JP.Code&&a!==c.JP.Markdown,j=(0,p.useRef)(null),k=R&&!i,[O,A]=(0,p.useState)(null),I=(0,p.useCallback)(e=>{void 0!==y&&void 0!==v&&(void 0!==C&&C(e),A({error:e,artifactId:y,artifactVersion:v}))},[y,v,C]);(0,p.useEffect)(()=>{var e;if(!w||!m)return;let t=w.versions[w.versions.length-1],n=w.versions[w.versions.length-2];if(!n||!t||"update"!==t.command)return;let s=P(n.resultState,t.resultState);-1!==s&&(null===(e=j.current)||void 0===e||e.scrollToPercentage(s/100))},[n,w,m]),(0,p.useEffect)(()=>{!m&&j.current&&j.current.enableScrolling()},[m]);let L=(0,p.useCallback)(()=>{A(e=>e&&(e.artifactId!==y||e.artifactVersion!==v)?null:e)},[y,v]),F=(0,p.useCallback)(()=>{A(null)},[]);return(0,s.jsxs)(s.Fragment,{children:[R&&(0,s.jsxs)("div",{className:(0,u.Z)("ease-out duration-200",k?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",S&&q),children:[(0,s.jsx)(M.e,{ref:d,className:k?"h-full w-full border-none bg-always-white":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:k?n:void 0,type:k?a:void 0,onSandboxConfirmation:g,capabilities:x,onReportError:I,onSetContent:L,onRefresh:F,externalLinkBehavior:"ask",zoom:z}),k&&O&&(0,s.jsx)(E,{error:O,handleClose:()=>A(null),sendMessage:b?f:void 0,isStreaming:h})]}),void 0===n||void 0===a?null:a===c.JP.Code||i?(0,s.jsx)(l.l,{noDefaultScroll:!m,ref:j,className:(0,u.Z)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",S&&q),children:(0,s.jsx)(T,{content:n,isStreaming:h,language:o,sendMessage:f,isOpen:t},"code-".concat(y,"-").concat(v,"-").concat(m))}):a===c.JP.Markdown?(0,s.jsx)(l.l,{noDefaultScroll:!m,ref:j,className:(0,u.Z)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",S&&q),children:(0,s.jsx)(N,{content:n,citations:r,isStreaming:h,sendMessage:f,isOpen:t},"markdown-".concat(y,"-").concat(v,"-").concat(m))}):null]})},T=e=>{let{content:t,isStreaming:n,language:r,sendMessage:a,isOpen:l}=e,{codeStyle:c}=(0,i.o)();return(0,s.jsx)(S,{isStreaming:n,sendMessage:a,contentType:"code",isOpen:l,children:(0,s.jsx)(m.Z,{className:"code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed",language:r,PreTag:"div",style:c,renderer:o.S,children:t})})},N=e=>{let{content:t,citations:n,isStreaming:o,sendMessage:i,isOpen:l}=e,c=(0,d.X)(),u=(0,p.useMemo)(()=>c&&n&&n.length>0?(0,a.NM)(n,t):t,[t,n,c]);return(0,s.jsx)(S,{isStreaming:o,sendMessage:i,isOpen:l,children:(0,s.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-message mx-auto w-full max-w-3xl leading-[1.65rem] -tracking-[0.015em] px-6 pt-4 md:pt-6 md:px-11",children:[(0,s.jsx)(r.ux,{text:u,blockCitations:n,className:"!gap-3.5"}),(0,s.jsx)("div",{className:"h-8"})]})})},P=(e,t)=>{if(!e||!t)return -1;let n=e.replace(/\\n/g,"\n"),s=t.replace(/\\n/g,"\n"),o=[...n].findIndex((e,t)=>e!==s[t]);if(-1===o&&n.length===s.length)return -1;let r=(n.slice(0,-1===o?n.length:o).match(/\n/g)||[]).length,a=(n.match(/\n/g)||[]).length;return a?Math.round(r/a*100):-1}},56065:function(e,t,n){n.d(t,{e:function(){return b}});var s=n(27573),o=n(8392),r=n(8571),a=n(70354),i=n(87033),l=n(45144),c=n(10607),d=n(8927),u=n(68425),p=n(7653),m=n(40950),h=n(45790),g=n(93558),f=n(37584),x=n(17796);let b=(0,p.forwardRef)((e,t)=>{let{content:n,className:b,type:y,onSandboxConfirmation:v,capabilities:C,onReportError:w,onSetContent:S,onRefresh:z,externalLinkBehavior:R,onOpenExternalLinkRequest:j,lazy:E=!0,zoom:M=1}=e,q=(0,m.Z)(),{userContentRendererUrl:k}=(0,r.mX)(),[T,N]=(0,p.useState)(!1),P=(0,p.useRef)(null),[O,A]=(0,p.useState)(null),{value:I}=(0,i.FL)("apps_use_turmeric"),[L,F]=(0,p.useState)(0),H=e=>e>=100,{sendRequest:Z,updatePermission:G}=function(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:s=null,initialPermissions:o,onPermissionRequested:r,onCapabilityAction:a}=e,[i,l]=(0,p.useState)(null),c=(0,p.useRef)(o),[d,u]=(0,p.useState)(0);(0,p.useEffect)(()=>{if(!t.current&&d<20){let e=setTimeout(()=>{u(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current){console.warn("Max retries reached while waiting for iframe");return}let e=new x.i({iframe:t.current,allowedOrigin:n,onRateLimited:s,onPermissionRequested:async e=>{if(g.TD.includes(e)||"accepted"===c.current[e])return"accepted";let t=await r(e);return c.current={...c.current,[e]:t},t},onCapabilityAction:a});return l(e),()=>{e.cleanup()}},[t,n,c,s,r,a,d]);let m=(0,p.useCallback)(async(e,t)=>{if(i)return i.sendRequest(e,t);throw Error("Communicator not initialized")},[i]),h=(0,p.useCallback)(()=>{null==i||i.restartListening()},[i]),f=(0,p.useCallback)((e,t)=>{c.current={...c.current,[e]:t}},[]);return{sendRequest:null===i?void 0:m,restartListening:h,permissions:c.current,updatePermission:f}}({iframeRef:P,allowedOrigin:k,onCapabilityAction:(0,p.useCallback)(async e=>{if(e.method===g.to.ReadyForContent)return N(!0),null==v||v(),Promise.resolve();if(e.method===g.to.GetFile)return C&&C.getFile?Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse",value:await C.getFile(e.payload.key)}):Promise.reject();if(e.method===g.to.SendConversationMessage)return C&&C.sendMessage?(await C.sendMessage({prompt:e.payload.message,attachments:[],files:[],syncSources:[]}),Promise.resolve()):Promise.reject();if(e.method===g.to.ClaudeCompletion)return C&&C.claudeComplete?(F(e=>e+1),Promise.resolve({"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse",completion:await C.claudeComplete(e.payload.prompt)})):Promise.reject();if(e.method===g.to.BroadcastContentSize)return Promise.resolve();if(e.method===g.to.OpenExternal){if("ask"===R)return A(e.payload.href),Promise.resolve();if("bubble"===R&&j)return j({href:e.payload.href}),Promise.resolve()}else if(e.method===g.to.ReportError)return null==w||w(e.payload.error),Promise.resolve();return Promise.reject()},[v,C,N,w,F,R,j]),onPermissionRequested:(0,p.useCallback)(async e=>e===g.to.ClaudeCompletion&&H(L)?"denied":Promise.resolve("accepted"),[L]),initialPermissions:{}});(0,p.useEffect)(()=>{H(L)&&(G(g.to.ClaudeCompletion,"denied"),(0,l.uT)("Claude completion request limit hit."))},[L,G]);let D=(0,p.useCallback)(()=>{(0,l.uT)("Claude completion modal confirmed"),F(0),G(g.to.ClaudeCompletion,"accepted")},[G]),_=(0,p.useCallback)(async()=>{let e=await (null==Z?void 0:Z(g.to.GetScreenshot,f.D7));if(null==e?void 0:e.screenshot){if(e.screenshot.length>10485760)throw Error(q.formatMessage({defaultMessage:"Screenshot too large",id:"ifBuzEbIz2"}));if(!/^data:image\/(png|jpeg|gif);base64,/.test(e.screenshot))throw Error(q.formatMessage({defaultMessage:"Invalid screenshot format",id:"KCmGxpLNuq"}));return e.screenshot}},[q,Z]),B=(0,p.useCallback)(async()=>{let e=await (null==Z?void 0:Z(g.to.CopyHtmlContent,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest"}));return null==e?void 0:e.reportHTMLContent},[Z]);return(0,p.useEffect)(()=>{T&&n&&y&&(null==S||S(),null==Z||Z(g.to.SetContent,{content:n,type:y,"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"}))},[n,Z,y,T,S]),(0,p.useImperativeHandle)(t,()=>({refresh:()=>{null==z||z(),N(!1);let e=P.current;e&&(e.src="".concat(k).concat(w?"?errorReportingMode=parent":""))},getScreenshot:_,copyHtmlContent:B})),(0,s.jsxs)("div",{className:(0,c.Z)("relative",b),children:[(0,s.jsx)("iframe",{ref:P,className:"h-full w-full",style:{zoom:M},sandbox:"allow-scripts allow-same-origin",title:q.formatMessage({defaultMessage:"Claude content",id:"/Ma3teJf9/"}),loading:E?"lazy":void 0,src:"".concat(k).concat(w?"?errorReportingMode=parent":""),allow:"fullscreen; clipboard-write"}),(0,s.jsx)(d.M,{children:!T&&(0,s.jsx)(u.E.div,{className:"bg-bg-100 absolute inset-0 z-10",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"}})}),O?(0,s.jsx)(o.o,{isOpen:!!O,url:O,onClose:()=>A(null),onConfirm:()=>{O&&window.open(O,"_blank"),A(null)}}):null,I&&H(L)&&(0,s.jsx)("div",{className:"fixed inset-0 bg-always-black bg-opacity-50 flex items-center justify-center z-modal",children:(0,s.jsxs)("div",{className:"bg-bg-100 p-4 rounded shadow-lg",children:[(0,s.jsx)("p",{className:"text-fg-100 mb-4",children:(0,s.jsx)(h.Z,{defaultMessage:"Many requests made. Acknowledge that you’re still here to continue.",id:"kmh/1AmVcl"})}),(0,s.jsx)(a.z,{onClick:D,variant:"primary",children:(0,s.jsx)(h.Z,{defaultMessage:"I’m still here",id:"NwhjMfjigc"})})]})})]})});b.displayName="RichSandbox"},93558:function(e,t,n){n.d(t,{KX:function(){return m},O3:function(){return b},P2:function(){return f},TD:function(){return y},q2:function(){return x},to:function(){return o},vr:function(){return h}});var s,o,r=n(82083),a=n(41270),i=n(37584);(s=o||(o={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",s.SetContent="anthropic.claude.usercontent.sandbox.SetContent",s.GetFile="anthropic.claude.usercontent.sandbox.GetFile",s.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",s.RunCode="anthropic.claude.usercontent.sandbox.RunCode",s.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",s.ReportError="anthropic.claude.usercontent.sandbox.ReportError",s.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",s.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize",s.OpenExternal="anthropic.claude.usercontent.sandbox.OpenExternal",s.CopyHtmlContent="anthropic.claude.usercontent.sandbox.CopyHtmlContent";let l=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),c=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),d=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),u=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[l,c,d,u]),m=a.z.object({code:a.z.string()}),h=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.CopyHtmlContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.CopyHtmlContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse"),reportHTMLContent:a.z.string()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.nativeEnum(r.JP),watchContentSize:a.z.boolean().optional()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.z.number(),width:a.z.number()})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(h)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({screenshot:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.OpenExternal":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.OpenExternal"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"),href:a.z.string()})}),responseSchema:i.AY,alwaysPermitted:!0}},f=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize","anthropic.claude.usercontent.sandbox.OpenExternal"]),x=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,g["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema,g["anthropic.claude.usercontent.sandbox.OpenExternal"].requestSchema]);a.z.union([i.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot","anthropic.claude.usercontent.sandbox.CopyHtmlContent"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].requestSchema]);let b=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].responseSchema]),y=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},37584:function(e,t,n){n.d(t,{AY:function(){return l},D7:function(){return c},Kj:function(){return i},Tk:function(){return a},Zq:function(){return r},qV:function(){return o},v8:function(){return d}});var s=n(41270);let o=s.z.object({channel:s.z.enum(["request","response"]),requestId:s.z.string()}).passthrough(),r=o.strict().extend({channel:s.z.literal("request"),method:s.z.string(),payload:s.z.strictObject({"@type":s.z.string()})}),a=o.extend({channel:s.z.literal("response"),status:s.z.number().int().min(100).max(599),payload:s.z.strictObject({"@type":s.z.string()}).passthrough()}).passthrough(),i=a.extend({status:s.z.number().int().min(400).max(599),payload:s.z.strictObject({"@type":s.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:s.z.string()})}),l=a.extend({payload:s.z.strictObject({"@type":s.z.literal("type.googleapis.com/google.protobuf.Empty")})}),c={"@type":"type.googleapis.com/google.protobuf.Empty"},d=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},17796:function(e,t,n){n.d(t,{i:function(){return a}});var s=n(93558),o=n(37584);let r=new Map;class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=o.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let s=n.data;if("response"===s.channel){this.handleResponse(s);return}this.messageQueue.push(s),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||r.get(e.requestId);if(void 0!==t){t(e),r.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=s.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,r=s.q2.safeParse(e);if(!r.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=r.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=o.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:o.D7}),s=this.requestLog.get(a.requestId);s&&this.requestLog.set(a.requestId,{...s,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var s;let r=o.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,o.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:r,responseTimestamp:new Date().getTime()}),null===(s=this.iframe.contentWindow)||void 0===s||s.postMessage(r,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,a)=>{var i;let l=Date.now().toString(),c=e=>{let t=o.Tk.safeParse(e);if(!t.success){a(Error("Invalid response format"));return}let r=t.data;if(r.status>=400){let e=o.Kj.safeParse(r);e.success?a(Error(e.data.payload.error)):a(Error("Error response (".concat(r.status,")")));return}let i=s.O3.safeParse(r);i.success?n(i.data.payload):a(Error("Invalid response payload for the method"))};this.inFlightRequests.set(l,c),r.set(l,c),null===(i=this.iframe.contentWindow)||void 0===i||i.postMessage({channel:"request",method:e,requestId:l,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:s,onCapabilityAction:o}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=s,this.onCapabilityAction=o,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}},84575:function(e,t,n){n.d(t,{w:function(){return a}});var s=n(27573),o=n(32737),r=n(10607);function a(e){let{Icon:t,children:n,isAssistant:a=!0,tooltipContent:i,...l}=e;return(0,s.jsx)(o.u,{className:"mt-1",side:"bottom",delayDuration:100,tooltipContent:i,children:(0,s.jsxs)("button",{...l,className:(0,r.Z)("flex flex-row items-center gap-1.5 rounded-md p-2 text-sm transition text-text-300 active:scale-95","select-auto",a?"hover:bg-bg-300 py-1.5":"hover:bg-bg-500 py-1",l.className),children:[t&&(0,s.jsx)(t,{size:16}),n]})})}n(7653)},39527:function(e,t,n){n.d(t,{l:function(){return r}});var s=n(27573),o=n(7653);let r=(0,o.forwardRef)((e,t)=>{let{className:n,children:r,disabled:a,noDefaultScroll:i}=e,l=(0,o.useRef)(0),c=(0,o.useRef)(!0),d=(0,o.useRef)(null),u=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(d.current&&c.current){if(d.current.scrollHeight-d.current.clientHeight<d.current.scrollTop)return;if(d.current&&"function"==typeof d.current.scrollTo){var t,n,s;null===(s=d.current)||void 0===s||s.scrollTo({top:(null===(t=d.current)||void 0===t?void 0:t.scrollHeight)-(null===(n=d.current)||void 0===n?void 0:n.clientHeight)+5,behavior:e})}}},[]),p=(0,o.useCallback)(e=>{if(d.current&&d.current&&"function"==typeof d.current.scrollTo){var t,n,s;d.current.style.overflow="hidden",null===(s=d.current)||void 0===s||s.scrollTo({top:(null===(t=d.current)||void 0===t?void 0:t.scrollHeight)*e-(null===(n=d.current)||void 0===n?void 0:n.clientHeight)/2,behavior:"auto"})}},[]),m=(0,o.useCallback)(()=>{d.current&&(d.current.style.overflow="")},[]);return(0,o.useImperativeHandle)(t,()=>({reset(){l.current=0,c.current=!0,i||u()},scrollToBottomIfPinned:u,scrollToPercentage:p,enableScrolling:m}),[u,p,m,i]),(0,o.useLayoutEffect)(()=>{a||!r||i||u()},[r,a,u,i]),(0,s.jsx)("div",{className:n,onScroll:e=>{if(a)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(d.current,t),s=t>l.current;n&&s?c.current=!0:n||s||(c.current=!1),l.current=t},ref:d,children:r})});r.displayName="AutoScroll"}}]);