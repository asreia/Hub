# 正規表現

[サルにもわかる正規表現入門](https://userweb.mnet.ne.jp/nakama/)  
[基本的な正規表現一覧](https://murashun.jp/blog/20190215-01.html)  
[正規表現チェッカー](https://weblabo.oscasierra.net/tools/regex/)  
[[正規表現] .*?は最短マッチではない](https://qiita.com/anqooqie/items/191ad215e93237c77811)  
[正規表現を可視化してくれるサイト](https://jex.im/regulex/#!flags=&re=%5E(a%7Cb)*%3F%24)  
[正規表現における$1を使った部分置換の方法](https://uxmilk.jp/50944)  
[複数行にまたがる処理](https://qiita.com/officemove/items/a6caa20c978197eaff50)  
[とほほの正規表現入門](https://www.tohoho-web.com/ex/regexp.html)

## 考察

- 正規表現は、文字列と正規表現からその文字列の部分文字列を検索する。  
"xx...x" `Search` "aa.*" => "xxx", "xxxx", .."xx"  

- 正規表現の最左の文字からマッチしているか検証する  

- W(indows|INDOWS) ?９[８５]

正規表現のメタ文字は、文脈キーワード(contextual keyword)のような挙動をし、メタ文字として機能する状況ではメタ文字となり機能しない場合は普通の文字となる。  
  メタ文字として機能する状況で普通の文字として扱いたい場合はエスケープ(\\)する。  

- **まとめ(最新)**
  - 基本
    - 検索の正規表現に対して、**ファイルの一番初め(最左)から**、その正規表現にマッチしているか**一❰文字❱づつ❰チェック❱**していく
      {❰チェック❱❰文字❱❰文字❱❰文字❱} => {❰文字❱❰チェック❱❰文字❱❰文字❱} => {❰文字❱❰文字❱❰チェック❱❰文字❱} => {❰文字❱❰文字❱❰文字❱❰チェック❱}
    - 正規表現に一致する最初の文字❰1❱が出現したら、**一致開始位置を❰マーク❱**し、正規表現の**最後の文字まで一致したら❰マッチ～❱**とする。
      その後、⟪**❰マッチ～❱が起きた位置**から¦**❰チェック❱に❰失敗❱**したら⟫、再び正規表現の最初の文字❰1❱に一致するか❰チェック❱していく。
      検索: "12", 文字列: "12112"
      {**❰チェック❱**12112} => {❰マーク❱1 **❰チェック❱**2112} => {❰マーク❱12❰マッチ1❱**❰チェック❱**112} =>
      {❰マーク❱12❰マッチ1❱❰マーク❱1 **❰チェック❱**12} => {❰マーク❱12❰マッチ1❱❰マーク❱1❰失敗❱❰マーク❱1 **❰チェック❱**2} =>
      {❰マーク❱12❰マッチ1❱❰マーク❱1❰失敗❱❰マーク❱12❰マッチ2❱**❰チェック❱**} => {❰マーク❱12❰マッチ1❱❰マーク❱1❰失敗❱❰マーク❱12❰マッチ2❱❰失敗❱}
  - 最短一致❰?❱
    - **可変長な正規表現**(❰`?`❱,❰`*`❱,❰`+`❱,❰`{,}`❱)の**直後に❰?❱を付ける**と**最短一致**となる。
      その場合、最左から❰チェック❱して行き、その可変長な正規表現の**最小限の文字列に❰マッチ～❱**する。
      (**最短一致**は、❰`?`❱の直後(`.\*?❰ココ❱`)が一致(｡｡0個の一致の場合(｡❰`?`❱など(例:`.*?[\n]?\{`)｡)は次の文字に一致?(例:`{`)｡｡)しないか❰チェック❱し、一致しない場合は❰`.*`❱を❰チェック❱する。**最長一致**はその❰チェック❱の順序が逆)(`A+?`のように❰`?`❱の直後に何も無い場合は既に❰マーク❱されていれば**常に❰マッチ～❱**とする?)
      - `A+` と `A+?`
        - 検索: `A+`, 文字列: `AAAA` (最長一致)
          **マッチ1**: `AAAA`
        - 検索: `A+?`, 文字列: `AAAA` (最短一致)
          **マッチ1**: `A`, **マッチ2**: `A`, **マッチ3**: `A`, **マッチ4**: `A`
      - 1.*2 と 1.*?2
        - 検索: `1.*2`, 文字列: `12_1a2` (最長一致)
          **マッチ1**: `12_1a2`
        - 検索: `1.*?2`, 文字列: `12_1a2` (最短一致)
          **マッチ1**: `12`, **マッチ2**: `1a2`
  - アサーション またこんどまとめる..

## 言語表現との対応

文字に作用するメタ文字❰^\$[\]?+*{,}❱と文字"列"に作用するメタ文字❰(|)❱がある。
範囲があるメタ文字(?*+{,})の後に"?"を付けると最短一致になる。  
  最長一致は範囲の上限にマッチしようとする。最短一致は範囲の下限に最左マッチ(AAAA {A+} => {AAAA} {A+?} => {A}, AABBCC {A.*?C} => {AABBC}))  
`{()} <=> {❰❱}`  
`{.} <=> {∫LChar∫∸❰\n❱} <=> {[\s\S]}かな?`  
`{[\s\S\n]} <=> {∫LChar∫}`『改行も含む(複数行の検索に使える`[\s\S\n]*?`)  
`{ABC|DEF} <=> {⟪ABC¦DEF⟫}`  
`{^A} <=> {❰\n❱A}`  
`{A$} <=> {A❰\n❱}`  
`{A?} <=> {＠❰A❱}`  
`{A*} <=> {⟦～⟧❰A❱}`  
`{A+} <=> {⟦1～⟧❰A❱} <=> {A{1,}}`  
`{[ABC]} <=> {⟪A¦B¦C⟫}` "[]"のなかで"()"は使えない  
`{[^ABC]} <=> {∫LChar∫∸⟪A¦B¦C⟫}`  
`{[A-Z0-9]} <=> {⟪U+┃U+A～U+Z⟫∪⟪U+┃U+0～U+9⟫}`
`{A{2,4}} <=> {⟦2～4⟧A}`  
`{A{2,}} <=> {⟦2～⟧A}`  
`{A{2}} <=> {⟦┃2┃⟧A}`  

- 置換 (正規表現(.*)を❰()❱で囲み、置換は❰$⟪1～⟫❱で❰()❱を左から⟪1～⟫順に参照する)
  - 検索:`(ab)cd(ef)`, 置換`$2__$1`『置換には.*などの正規表現が使えない
    結果: `abcdef` => `ef__ab`     『`cd`を`__`に置換し、`❰$1❱==❰(ab)❱`と`❰$2❱==❰(ef)❱`を`$2∫LAny∫$1`にし入れ替え`ef∫LAny∫ab`と置換した

- [Visual Studio Codeの正規表現検索で、「ファイル先頭」「ファイル末尾」を検索する](https://tonakai1070.com/vscode_regex_begn_end_file)
  - ファイル先頭にマッチ: `^(?<!\n)`『例: 検索:`^(?<!\n)`, 置換`ファイルの先頭に追加したい文字列\n`
  - ファイル末尾にマッチ: `$(?!\n)`

- 複数行`[\s\S\n]*?`
  [VS Codeで複数行に渡って正規表現を利用する](https://qiita.com/birdwatcher/items/dee34a11619b11e1fe81)
  [正規表現の例文-複数行にまたがる処理](https://qiita.com/officemove/items/a6caa20c978197eaff50)
  - 例1
    - 文字列:  `A__B\n__C__\n__D`
    - 検索:`(A)[\s\S\n]*?(B)[\s\S\n]*?(C)[\s\S\n]*?(D)`『`[\s\S\n]`は`⟪_¦\n⟫`を含む全ての文字にマッチする(`.`の`⟪_¦\n⟫`を含む版)(`[.\n]`はだめ?→`[.]`は文字列の`.`と認識される)
      - \s: 空白文字を表す。[ \t\n\r\f]と同じ
        \S: 非空白文字を表す。[ \t\n\r\f]以外の一文字。
  - 例2
    - 文字列:`A__B\n__C__\n__D`
    - 検索:  `(^(?<!\n)[\s\S\n]*?C)`
    - 置換:  `//❰C❱がある先頭に挿入\n$1`
    - 結果:  `//❰C❱がある先頭に挿入\nA__B\n__C__\n__D`
  - 例3
    - 文字列:`UnityC#ファイル群`
    - 検索:  `(^(?<!\n)[\s\S\n]*?#if UNITY_EDITOR)`と`[単語単位で検索する]にチェック`『何故かチェックしないとうまく行かなかった
      - (?<!y)x 『否定後読みアサーション: "x" の前に "y" がない場合のみ "x" に一致します。[](https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Regular_expressions/Assertions)
        - `^`で行の始まりを見つける=>`^`の前に`\n`が無いものにマッチする(`(?<!\n)`だけで意味を持つ)『`^`,`$`,`(?＠❰<❱⟪=¦!⟫∫LChar∫)`とかは位置だけの情報を持つ?
    - 置換:  `#define UNITY_EDITOR\n\n$1`
    - 結果： `#define UNITY_EDITOR\n\n⟪＃ファイル内容＃⟫`
  - 例4 日本語を含むコメントの行にマッチ
    - 検索: `//.*[ぁ-んァ-ヶー一-龯]+.*`『**正規表現は左から最長一致でマッチしていく**
    - 結果: `//日本語を含むコメント`
  - 例5 関数名でその定義にマッチ
    - 検索: `関数名[\s]*\(.*\).*?[\n]?\{`

## メタ文字

- +<?>  
  - 最長一致: `<C>{<N>,<M>}`は`{<N>,<M>}`を満たす最長の文字列にマッチ
    - 『次の文字列(`⟪*¦+⟫ココ`)が**最後に**出現するまでの文字列にマッチ。または、`ココ⟪*¦+⟫`が`ココ`が続く限りの文字列にマッチ
  - 最短一致: `<C>{<N>,<M>}<?>`は`{<N>,<M>}`を満たす最短の文字列にマッチ❰☆❱
    - 『次の文字列(`⟪*¦+⟫?ココ`)が**初めて**出現するまでの文字列にマッチ。または、`ココ⟪*¦+⟫?`が`ココ`がちょうど⟪0回¦1回⟫満たす文字列マッチ(意味無い)

\<C> == 文字?, \<S> ==文字列?❰☆❱  
| メタ文字                              | マッチ                                                |
| :------------------------------------ | :---------------------------------------------------- |
| `<\[<S>\]>|<\[<N>\-<M>\]>|<\[^<S>\]>` | \<S>の一文字づつ \| \<N>から\<M>までのASCII文字       |
|                                       | \| \<S>の一文字づつ以外の一文字づつ                   |
| `.`❰☆❱                                | . == [^] 任意の一文字                                 |
| `<C>{+<N>,+<M>}+<?>`                  | \<C>が\<N>から\<M>個の連続した文字。省略した場合{0,∞} |
| `<C>(<*>|<+>|<?>)+<?>`❰☆❱             | \<*> == {0,} \| \<+> == {1,} \| \<?> == {0,1}         |
| `^<S>`❰☆❱                             | \<S>から始まる文字列                                  |
| `<S>$`❰☆❱                             | \<S>で終わる文字列                                    |
| `<S1>|<S2>`❰☆❱                        | \<S1>または\<S2>の文字列                              |
| `\<M>`❰☆❱                             | メタ文字のエスケープシーケンス                        |
| `(<正規表現>)`❰☆❱                     | ただの正規表現の結合則括弧                            |

## Google検索演算子

[Google検索演算子](https://gigazine.net/news/20190128-google-advanced-search-operator/)

| 演算子       | 意味                                                          |
| :----------- | :------------------------------------------------------------ |
| `<S1> <S2>`  | AND検索                                                       |
| `<S1>|<S2>`  | OR検索                                                        |
| `()`         | `(<S1>|<S2>) <S3>` 論理演算括弧                               |
| `/-<S>`      | 検索から除外                                                  |
| `"<S>"`      | 完全一致                                                      |
| `<S1>*<S2>`  | ワイルドカード (`"<S1>"*"<S2>"`の方がいいかも?)               |
| `site:<URL>` | サイト内検索 (`site:https://www.nicovideo.jp "そんなばなな"`) |
| `define:<S>` | google辞書                                                    |
| `<N1>..<N2>` | 数字の範囲 (`"<N1>..<N2> +<S>"`じゃないと上手くいかない)      |
